---
title: "JOINTHUBS"
output:
  flexdashboard::flex_dashboard:
    css: styles.css
    logo: logo.png
date: ""
runtime: shiny
resource_files:
- intro.png

---
```{r setup, include=FALSE}
options(scipen = 999999)
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE)

library(tidyverse)
library(tidytuesdayR)
library(scales)
library(tidytext)
library(plotly)

source("functions.r")

# tt <- tt_load("2021-03-02")
# saveRDS(tt, "tt.rds")
tt <- readRDS("tt.rds")

youtube <- tt$youtube %>%
  dplyr::select(-favorite_count) %>%
  mutate(brand = fct_recode(brand, Hyundai = "Hynudai"))

gathered_categories <- youtube %>%
  gather(category, value, funny:use_sex) %>%
  mutate(category = str_to_title(str_replace_all(category, "_", " ")))

coefficients <- gathered_categories %>%
  group_by(category) %>%
  summarize(model = list(glm(value ~ year, family = "binomial"))) %>%
  mutate(td = map(model, broom::tidy)) %>%
  unnest(td) %>%
  filter(term != "(Intercept)") %>%
  arrange(desc(estimate))

by_brand_category <- gathered_categories %>%
  group_by(brand, category) %>%
  summarize(pct = mean(value)) %>%
  ungroup()

pl <- youtube %>%
  filter(!is.na(view_count)) %>%
  mutate(rating = round(like_count / (like_count + dislike_count) * 100, 2)) %>% 
  dplyr::select(brand, year, title, description, 
         view_count, rating, like_count,
         dislike_count) 
```

<link href="https://fonts.googleapis.com/css?family=Audiowide" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">

Intro {data-icon="fa-braille"}
=====================================     

Column 1{data-width=100}
-------------------------------------

<h4>
Social Media
</h4>
<h5>
[LinkedIn](https://www.linkedin.com/company/bdmp-corp)

[Facebook](https://www.facebook.com/jointhubscorp)
</h5>

<h4>
Links
</h4>
<h5>
[Tidy Tuesday](https://www.tidytuesday.com/)

[Data](https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-03-02/readme.md)

[Youtube Analysis](https://www.youtube.com/watch?v=EHqFDXa-sH4) 

[Github - dgrtwo/data-screencasts](https://github.com/dgrtwo/data-screencasts)
</h5>


Column 1
-------------------------------------

<center>

![](jointhub-Page-16.png)

</center>

Data{data-icon="fa-chess-board"}
=====================================     

Column 2{data-width=166}
-------------------------------------

### Analyzed commercials
```{r predsf}
renderPlot({
  youtube %>%
  count(brand, sort = TRUE) %>%
  head(20) %>%
  mutate(brand = fct_reorder(brand, n)) %>%
  ggplot(aes(n, brand)) +
  geom_col(fill = "#329E99") +
  labs(title = "",
       x = "",
       y = "") +
  jtTheme()
})
```

### Generated actions
```{r data intro}
renderPlot({
  youtube %>%
  gather(metric, value, contains("_count")) %>%
  ggplot(aes(value)) +
  geom_histogram(binwidth = .5,
                 fill = "#329E99" ) +
  scale_x_log10(labels = comma) +
  labs(x = "# of views") +
  facet_wrap(~ metric)+
  labs(title = "",
       x = "",
       y = "")+
  jtTheme() +
    theme(axis.text.x = element_blank(),
          axis.text.y = element_blank())
})
```

Column 2{.tabset}
-------------------------------------

### Total Youtube Views
```{r tyv}
renderPlotly({
  youtube %>%
  filter(!is.na(view_count)) %>%
  group_by(year) %>%
  summarize(n = n(),
            total_views = sum(view_count),
            rating = round(mean(like_count / (like_count + dislike_count) * 100, na.rm = TRUE),2)) %>%
  ggplot(aes(year, total_views)) +
  geom_line(color = "#D9D9D9", size = 1.3, alpha = .7) +
  geom_point(aes(size = n,
                 color = rating)) +
  scale_y_continuous(labels = comma,
                     trans = "log10") +
  jtTheme() +
  labs(y = "",
       x = "",
       size = "Number of commercials [size]",
       color = "Likes [%]",
       title = "")
})
```

### Most viewed commercials ranking
```{r first}
renderPlotly({
  pl %>%
  filter(view_count >= quantile(view_count, .8)) %>%
  ggplot(aes(rating, view_count)) +
  geom_point(aes(color = brand,
                 label = title,
                 label2 = description,
                 label3 = year,
                 label4 = like_count,
                 label5 = dislike_count),
             size = 3,
             alpha = .7) +
  scale_y_continuous(labels = comma,
                     trans = "log10")  +
  jtTheme() +
  theme(legend.position = "none") +
  labs(x = "",
       y = "",
       title = "")
})
```

### Number of commercials by brands
```{r results}
renderPlot({
  youtube %>%
  ggplot(aes(year, fill = brand)) +
  geom_bar() +
  facet_wrap(~ brand) +
  labs(title = "",
       x = "",
       y = "")+
  jtTheme()  +
  theme(legend.position = "none") 
})
```


Commercial Features {data-icon="fa-barcode"}
=====================================     

Column 2{data-width=300}
-------------------------------------

### Measured features
```{r data table}
renderPlot({
  gathered_categories %>%
  filter(!is.na(view_count)) %>%
  group_by(category, value) %>%
  summarize(n = n(),
            total_views = sum(view_count)) %>%
  ggplot(aes(total_views, category, fill = value)) +
  geom_col(position = "dodge") +
  scale_x_continuous(labels = comma) +
  jtTheme() +
  labs(y = "",
       x = "", 
       fill = "Color",
       title = "Total views")
})
```

Column 2{data-width=300}
-------------------------------------

### Commercial features in time
```{r plot total}
renderPlot({
  gathered_categories %>%
  group_by(category,
           year = 2 * (year %/% 2)) %>%
  summarize(pct = mean(value),
            n = n()) %>%
  inner_join(coefficients, by = "category") %>%
  filter(p.value <= .01) %>%
  ggplot(aes(year, pct, color = category)) +
  geom_line(size = 2,
            alpha = .8) +
  scale_y_continuous(labels = percent) +
  facet_wrap(~ category) +
  jtTheme() +
  theme(legend.position = "none") +
  labs(y = "",
       x = "", 
       title = "")
})
```


Brands Features {data-icon="fa-dna"}
=====================================     

Column 2{.tabset}
-------------------------------------

### Commercial features usage by brands
```{r diag2}
renderPlotly({
  by_brand_category %>%
  mutate(brand = reorder_within(brand, pct, category)) %>%
  ggplot(aes(pct, brand)) +
  geom_col(fill = "#329E99") +
  scale_x_continuous(labels = percent) +
  scale_y_reordered() +
  facet_wrap(~ category, scales = "free_y") +
  jtTheme() +
  theme(legend.position = "none",
        axis.text.y = element_text(size = 10)) +
  labs(y = "",
       x = "% of brand's ads have this quality", 
       title = "Commercial qualities")
})
```

### Brands commercial fingerprints
```{r byb}
renderPlot({
  by_brand_category %>%
  mutate(category = reorder_within(category, pct, brand)) %>%
  ggplot(aes(pct, category)) +
  geom_col(fill = "#329E99") +
  scale_x_continuous(labels = percent) +
  scale_y_reordered() +
  facet_wrap(~ brand, scales = "free_y") +
  jtTheme() +
  theme(axis.text.x = element_blank()) +
  labs(y = "",
       x = "% of brand's ads have this quality") +
  labs(title = "What is each brand's 'fingerprint' in terms of the type of ads it produces?")
})
```


### Brands & Commercial features heatmap
```{r ff}
renderPlot({
  by_brand_category %>%
  ggplot(aes(category, brand, fill = pct)) +
  geom_tile() +
  scale_fill_gradient2(low = "black", 
                       high = "#329E99", 
                       midpoint = .5) +
  #coord_flip() +
  jtTheme() +
  theme(axis.text.x = element_text(size = 9)) +
  labs(x = "",
       y = "",
       fill = "Correlation")
})
```


